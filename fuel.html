<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É VK Bridge -->
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        vkBridge.send('VKWebAppInit');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAZ Smart Log</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap');

        :root {
            --primary-orange: #ff6600; /* –Ø—Ä–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π –∫–∞–∫ –Ω–∞ –∏–∫–æ–Ω–∫–µ */
            --card-bg: #18181b; /* –ì–ª—É–±–æ–∫–∏–π —Ç–µ–º–Ω—ã–π —Ü–≤–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ */
            --input-bg: rgba(255, 255, 255, 0.07);
            --text-white: #ffffff;
            --text-gray: #8e9299;
            --money-green: #00ff9d;
            --bg-color: #0f0f12;
            --danger-red: #ff4d4d;
            --edit-blue: #00bfff;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-white);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* –ü–ö –í–ï–†–°–ò–Ø */
        @media (min-width: 769px) {
            body {
                background-image: url('foto.jpg');
                background-size: cover;
                background-position: center;
                background-attachment: fixed;
                padding: 40px 0;
            }
            body::before {
                content: '';
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0, 0, 0, 0.7); /* –¢–µ–º–Ω–µ–µ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ */
                z-index: -1;
                backdrop-filter: blur(5px);
            }
            .mobile-header-image { display: none; }
        }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø */
        @media (max-width: 768px) {
            .mobile-header-image {
                display: block;
                width: 100%;
                height: auto;
                position: relative;
                z-index: 1;
            }
            .mobile-header-image img {
                width: 100%;
                height: auto;
                display: block;
                /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
                mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
                -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
            }
            .main-container {
                margin-top: -40px; /* –ß—É—Ç—å —Å–∏–ª—å–Ω–µ–µ –Ω–∞–µ–∑–∂–∞–µ–º –Ω–∞ —Ñ–æ—Ç–æ */
                position: relative;
                z-index: 2;
                padding: 0 15px;
            }
        }

        .main-container {
            width: 100%;
            max-width: 480px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 50px;
        }

        .calculator-card, .history-card {
            background: var(--card-bg); /* –ü–ª–æ—Ç–Ω—ã–π —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω */
            padding: 24px;
            border-radius: 24px; /* –ë–æ–ª–µ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã –∫–∞–∫ –Ω–∞ –º–∞–∫–µ—Ç–µ */
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        /* –£–±—Ä–∞–ª –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—É—é –ø–æ–ª–æ—Å—É —Å–≤–µ—Ä—Ö—É, —á—Ç–æ–±—ã –±—ã–ª–æ —á–∏—â–µ, –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */

        h1 {
            text-align: center;
            text-transform: uppercase;
            font-weight: 900;
            margin: 0 0 25px 0;
            letter-spacing: 0.5px;
            font-size: 1.5em;
            color: #fff;
        }

        h1 span {
            color: var(--primary-orange);
        }

        .mode-toggle {
            display: flex;
            background: rgba(0,0,0,0.3);
            border-radius: 14px;
            padding: 4px;
            margin-bottom: 25px;
        }

        .mode-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-gray);
            padding: 12px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 0.8em;
            cursor: pointer;
            border-radius: 10px;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .mode-btn.active {
            background: #2b2b30;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 0.7em;
            margin-bottom: 8px;
            color: var(--text-gray);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input {
            width: 100%;
            padding: 16px;
            box-sizing: border-box;
            background: var(--input-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            color: white;
            font-size: 1.1em;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-orange);
            background: rgba(255, 255, 255, 0.1);
        }

        input::placeholder {
            color: #4a4d55;
        }

        .hidden { display: none; }
        
        .row-2-col {
            display: flex;
            gap: 15px;
        }
        
        .row-2-col .input-group { flex: 1; }

        .btn-calc {
            width: 100%;
            padding: 20px;
            background: var(--primary-orange); /* –ü–ª–æ—Å–∫–∏–π —è—Ä–∫–∏–π —Ü–≤–µ—Ç */
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1em;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 15px;
            box-shadow: 0 10px 25px rgba(255, 102, 0, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-calc:active {
            transform: scale(0.98);
        }

        .results {
            margin-top: 25px;
            background: rgba(255,255,255,0.03);
            border-radius: 18px;
            padding: 20px;
            border: none;
            display: none;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-label {
            font-size: 0.85em;
            color: var(--text-gray);
            font-weight: 600;
        }

        .result-value {
            font-size: 1.2em;
            font-weight: 800;
            color: white;
        }
        
        .money-val {
            color: var(--primary-orange);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - —É–±—Ä–∞–ª —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        .global-stats-container {
            margin-top: 20px;
            padding: 20px;
            background: #232329;
            border-radius: 18px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.03);
            display: none;
        }

        .global-stats-container span {
            display: block;
            font-size: 0.7em;
            color: var(--text-gray);
            margin-bottom: 8px;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .global-stats-container strong {
            font-size: 1.8em;
            color: #fff;
            display: block;
            margin-bottom: 12px;
        }

        .global-sub-stat {
            font-size: 0.85em;
            color: #ccc;
            font-weight: 500;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .error-msg {
            color: #ff4d4d;
            background: rgba(255, 77, 77, 0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            font-size: 0.9em;
            display: none;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .history-header h3 {
            margin: 0;
            font-size: 1.1em;
            text-transform: uppercase;
            color: #fff;
            font-weight: 800;
        }

        .btn-clear {
            background: rgba(255, 77, 77, 0.1);
            border: none;
            color: #ff4d4d;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.7em;
            text-transform: uppercase;
            transition: 0.2s;
        }
        
        .btn-clear:hover {
            background: rgba(255, 77, 77, 0.2);
        }

        .table-container {
            max-height: 350px;
            overflow-y: auto;
            border-radius: 14px;
            background: rgba(0,0,0,0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75em;
        }

        th {
            text-align: left;
            padding: 14px 10px;
            background: #232329;
            position: sticky;
            top: 0;
            color: var(--text-gray);
            text-transform: uppercase;
            font-weight: 700;
            font-size: 0.9em;
        }

        td {
            text-align: left;
            padding: 14px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #eee;
            vertical-align: middle;
            font-weight: 600;
        }

        .td-money {
            color: var(--primary-orange);
            font-weight: 800;
        }

        tr.data-row {
            cursor: pointer;
            transition: background 0.2s;
        }
        tr.data-row:active {
            background: rgba(255,255,255,0.05);
        }

        .actions-row {
            display: none;
            background: rgba(0,0,0,0.2);
        }
        .actions-row.show {
            display: table-row;
            animation: fadeIn 0.3s;
        }

        .actions-wrapper {
            display: flex;
            gap: 10px;
            padding: 15px;
            justify-content: center;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-edit {
            background: rgba(0, 191, 255, 0.15);
            color: var(--edit-blue);
        }
        .btn-del {
            background: rgba(255, 77, 77, 0.15);
            color: var(--danger-red);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .hint-text {
            font-size: 0.7em;
            color: var(--text-gray);
            text-align: center;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #333; 
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div class="mobile-header-image">
        <img src="foto.jpg" alt="GAZ Header">
    </div>

    <div class="main-container">
        
        <div class="calculator-card">
            <h1>–†–∞—Å—Ö–æ–¥ <span>—Ç–æ–ø–ª–∏–≤–∞</span></h1>
            
            <div class="mode-toggle">
                <button class="mode-btn active" id="btn-mode-odo" onclick="setMode('odo')">–û–¥–æ–º–µ—Ç—Ä</button>
                <button class="mode-btn" id="btn-mode-dist" onclick="setMode('dist')">–ü—Ä–æ–±–µ–≥ (Trip)</button>
            </div>

            <div id="mode-odo-container">
                <div class="row-2-col">
                    <div class="input-group">
                        <label for="odo-prev">–°—Ç–∞—Ä—Ç (–∫–º)</label>
                        <input type="number" id="odo-prev" placeholder="10000">
                    </div>
                    <div class="input-group">
                        <label for="odo-curr">–§–∏–Ω–∏—à (–∫–º)</label>
                        <input type="number" id="odo-curr" placeholder="10450">
                    </div>
                </div>
            </div>

            <div id="mode-dist-container" class="hidden">
                <div class="input-group">
                    <label for="dist-direct">–ü—Ä–æ–µ—Ö–∞–Ω–æ (–∫–º)</label>
                    <input type="number" id="dist-direct" placeholder="450">
                </div>
            </div>

            <div class="row-2-col">
                <div class="input-group">
                    <label for="fuel-liters">–õ–∏—Ç—Ä—ã</label>
                    <input type="number" id="fuel-liters" placeholder="60">
                </div>
                <div class="input-group">
                    <label for="price-liter">–¶–µ–Ω–∞ –∑–∞ 1–ª</label>
                    <input type="number" id="price-liter" placeholder="55.50">
                </div>
            </div>

            <button class="btn-calc" onclick="calculateFuel()">
                –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
            </button>
            
            <div id="error-box" class="error-msg"></div>

            <div class="results" id="results-box">
                <div class="result-item">
                    <span class="result-label">–ü—Ä–æ–π–¥–µ–Ω–æ:</span>
                    <span class="result-value" id="res-distance">0 –∫–º</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–†–∞—Å—Ö–æ–¥ / 100–∫–º:</span>
                    <span class="result-value" id="res-consumption">0 –ª</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–∫–∏:</span>
                    <span class="result-value money-val" id="res-total-cost">0 ‚ÇΩ</span>
                </div>
                <div class="result-item" style="border-top: 1px solid rgba(255,255,255,0.05); margin-top:5px; padding-top:10px;">
                    <span class="result-label" style="color: #fff; font-weight:bold;">–¶–µ–Ω–∞ 1 –∫–º –ø—É—Ç–∏:</span>
                    <span class="result-value money-val" id="res-km-cost" style="font-size: 1.4em;">0 ‚ÇΩ</span>
                </div>
            </div>

            <div class="global-stats-container" id="global-stats-box">
                <span>–°—Ä–µ–¥–Ω–∏–π –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è</span>
                <strong id="global-avg">0.00 –ª/100–∫–º</strong>
                <div id="global-cost-avg" class="global-sub-stat">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ 1 –∫–º: 0.00 ‚ÇΩ</div>
            </div>
        </div>

        <div class="history-card">
            <div class="history-header">
                <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
                <button class="btn-clear" onclick="clearHistory()">–°–±—Ä–æ—Å</button>
            </div>
            <div class="hint-text">–ù–∞–∂–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–û–¥–æ</th>
                            <th>–ö–ú</th>
                            <th>–õ</th>
                            <th>–†—É–±</th>
                            <th>100–∫–º</th>
                        </tr>
                    </thead>
                    <tbody id="history-body"></tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        let calculationMode='odo';
        let historyData=JSON.parse(localStorage.getItem('gazFuelHistory'))||[];
        let lastPrice=localStorage.getItem('lastFuelPrice');

        window.onload=function(){
            renderHistoryTable();
            if(historyData.length>0){updateGlobalStats()}
            if(historyData.length>0 && historyData[0].currOdo){
                document.getElementById('odo-prev').value = historyData[0].currOdo;
            }
            if(lastPrice){document.getElementById('price-liter').value=lastPrice}
        };

        function setMode(e){
            calculationMode=e;
            const t=document.getElementById("btn-mode-odo"),l=document.getElementById("btn-mode-dist"),n=document.getElementById("mode-odo-container"),d=document.getElementById("mode-dist-container");
            document.getElementById("error-box").style.display="none";
            if("odo"===e){
                t.classList.add("active");
                l.classList.remove("active");
                n.classList.remove("hidden");
                d.classList.add("hidden");
                if(historyData.length>0 && historyData[0].currOdo && document.getElementById('odo-prev').value === "") {
                   document.getElementById('odo-prev').value = historyData[0].currOdo;
                }
            } else {
                l.classList.add("active");
                t.classList.remove("active");
                d.classList.remove("hidden");
                n.classList.add("hidden");
            }
        }

        function calculateFuel(){
            const liters=parseFloat(document.getElementById("fuel-liters").value);
            const price=parseFloat(document.getElementById("price-liter").value);
            const errorBox=document.getElementById("error-box");
            errorBox.style.display="none";

            let distance=0;
            let currentOdoValue=0;
            let lastOdo = historyData.length > 0 ? historyData[0].currOdo : 0;

            if("odo"===calculationMode){
                const odoPrev=parseFloat(document.getElementById("odo-prev").value);
                const odoCurr=parseFloat(document.getElementById("odo-curr").value);
                if(isNaN(odoPrev)||isNaN(odoCurr)) return void showError("–£–∫–∞–∂–∏—Ç–µ –æ–¥–æ–º–µ—Ç—Ä");
                if(odoCurr<=odoPrev) return void showError("–§–∏–Ω–∏—à > –°—Ç–∞—Ä—Ç–∞");
                distance = odoCurr - odoPrev;
                currentOdoValue = odoCurr;
            } else {
                const distDirect=parseFloat(document.getElementById("dist-direct").value);
                if(isNaN(distDirect)||distDirect<=0) return void showError("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–±–µ–≥");
                distance = distDirect;
                currentOdoValue = lastOdo + distance;
            }

            if(isNaN(liters)||liters<=0) return void showError("–í–≤–µ–¥–∏—Ç–µ –ª–∏—Ç—Ä—ã");
            if(isNaN(price)||price<=0) return void showError("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É");

            const consumption=liters/distance*100;
            const totalCost=liters*price;
            const costPerKm=totalCost/distance;

            document.getElementById("res-distance").innerText=distance.toFixed(1)+" –∫–º";
            document.getElementById("res-consumption").innerText=consumption.toFixed(2)+" –ª/100";
            document.getElementById("res-total-cost").innerText=Math.round(totalCost)+" ‚ÇΩ";
            document.getElementById("res-km-cost").innerText=costPerKm.toFixed(2)+" ‚ÇΩ";
            document.getElementById("results-box").style.display="block";

            localStorage.setItem("lastFuelPrice", price);

            const record={
                id:Date.now(),
                date:new Date().toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"}),
                dist:distance,
                lit:liters,
                price:price,
                totalCost:totalCost,
                cons:consumption,
                currOdo:currentOdoValue
            };
            historyData.unshift(record);
            if(historyData.length>200) historyData.pop();
            saveAndRender();

            document.getElementById('odo-prev').value = currentOdoValue;
            document.getElementById('odo-curr').value = "";
            document.getElementById('dist-direct').value = "";
        }

        function renderHistoryTable(){
            const tbody=document.getElementById("history-body");
            tbody.innerHTML="";
            if(historyData.length===0){
                tbody.innerHTML='<tr><td colspan="5" style="text-align:center; color:#666; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                document.getElementById("global-stats-box").style.display="none";
                return;
            }
            historyData.forEach(t=>{
                const costDisplay=t.totalCost?Math.round(t.totalCost):"-";
                const odoDisplay = t.currOdo ? t.currOdo : '-';
                
                // –°–¢–†–û–ö–ê –î–ê–ù–ù–´–•
                const rowData=`<tr class="data-row" onclick="toggleActions(${t.id})">
                    <td style="color:#fff; font-weight:bold;">${odoDisplay}</td>
                    <td>${t.dist.toFixed(0)}</td>
                    <td>${t.lit.toFixed(1)}</td>
                    <td class="td-money">${costDisplay}</td>
                    <td style="color:#fff; font-weight:bold;">${t.cons.toFixed(1)}</td>
                </tr>`;
                
                // –°–ö–†–´–¢–ê–Ø –°–¢–†–û–ö–ê –° –ö–ù–û–ü–ö–ê–ú–ò
                const rowActions=`<tr class="actions-row" id="act-${t.id}">
                    <td colspan="5">
                        <div class="actions-wrapper">
                            <button class="action-btn btn-edit" onclick="editItem(${t.id})">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                            <button class="action-btn btn-del" onclick="deleteItem(${t.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </td>
                </tr>`;
                
                tbody.insertAdjacentHTML("beforeend", rowData + rowActions);
            });
            updateGlobalStats();
        }

        function toggleActions(id) {
            document.querySelectorAll('.actions-row').forEach(row => {
                if(row.id !== 'act-' + id) row.classList.remove('show');
            });
            const row = document.getElementById('act-' + id);
            if(row) row.classList.toggle('show');
        }

        function deleteItem(id) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?")) {
                historyData = historyData.filter(item => item.id !== id);
                saveAndRender();
                if(historyData.length > 0 && historyData[0].currOdo) {
                    document.getElementById('odo-prev').value = historyData[0].currOdo;
                }
            }
        }

        function editItem(id) {
            if(confirm("–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è? –°—Ç–∞—Ä–∞—è –∑–∞–ø–∏—Å—å –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞.")) {
                const item = historyData.find(i => i.id === id);
                if(item) {
                    if (item.currOdo > 0) {
                        setMode('odo');
                        document.getElementById('odo-curr').value = item.currOdo;
                        document.getElementById('odo-prev').value = item.currOdo - item.dist;
                    } else {
                        setMode('dist');
                        document.getElementById('dist-direct').value = item.dist;
                    }
                    document.getElementById('fuel-liters').value = item.lit;
                    document.getElementById('price-liter').value = item.price;
                    
                    historyData = historyData.filter(i => i.id !== id);
                    saveAndRender();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }

        function updateGlobalStats(){
            if(0===historyData.length)return;
            document.getElementById("global-stats-box").style.display="block";
            let dist=0,lit=0,money=0;
            historyData.forEach(n=>{
                dist+=n.dist;
                lit+=n.lit;
                n.totalCost ? money+=n.totalCost : n.price&&n.lit&&(money+=n.price*n.lit)
            });
            if(dist>0){
                const avg=lit/dist*100;
                document.getElementById("global-avg").innerText=avg.toFixed(2)+" –ª/100–∫–º";
                const costKm=money/dist;
                document.getElementById("global-cost-avg").innerText="–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ 1 –∫–º: "+costKm.toFixed(2)+" ‚ÇΩ";
            }
        }

        function saveAndRender(){
            localStorage.setItem("gazFuelHistory",JSON.stringify(historyData));
            renderHistoryTable();
        }

        function clearHistory(){
            if(confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?")){
                historyData=[];
                saveAndRender();
                document.getElementById("results-box").style.display="none";
                document.getElementById("global-stats-box").style.display="none";
                document.getElementById("odo-prev").value="";
                document.getElementById("odo-curr").value="";
                document.getElementById("dist-direct").value="";
                document.getElementById("fuel-liters").value="";
            }
        }

        function showError(e){
            const t=document.getElementById("error-box");
            t.innerText=e;
            t.style.display="block";
        }
    </script>
</body>
</html>
