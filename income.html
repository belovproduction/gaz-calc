<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Учет по Рейсам</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #000000;
            --card-bg: #1c1c1e;
            --input-bg: #2c2c2e;
            --orange-accent: #ff6d00;
            --text-white: #ffffff;
            --text-gray: #8e8e93;
            --danger: #ff453a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-body);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-white);
            padding-bottom: 40px;
        }

        /* Имитация картинки-шапки как на скрине */
        .header-image-container {
            width: 100%;
            height: 280px;
            position: relative;
            z-index: 0;
        }

        .header-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Градиент в черный снизу */
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        .main-wrapper {
            width: 100%;
            max-width: 450px;
            margin-top: -60px; /* Наезжаем на картинку */
            padding: 0 16px;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- НАВИГАЦИЯ ПО РЕЙСАМ (Чипсы) --- */
        .trips-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .trips-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 4px;
            flex: 1;
            scrollbar-width: none; 
        }
        .trips-scroll::-webkit-scrollbar { display: none; }

        .trip-chip {
            background: var(--input-bg);
            padding: 8px 16px;
            border-radius: 20px;
            min-width: 90px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
        }

        .trip-chip-name {
            font-size: 11px;
            font-weight: 700;
            color: #ccc;
            white-space: nowrap;
            text-transform: uppercase;
        }

        .trip-chip-date {
            font-size: 9px;
            color: #666;
            margin-top: 2px;
        }

        .trip-chip.active {
            background: #3a3a3c;
            border: 1px solid var(--orange-accent);
        }
        .trip-chip.active .trip-chip-name { color: white; }

        .add-trip-btn {
            background: var(--input-bg);
            color: var(--orange-accent);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            flex-shrink: 0;
            border: none;
            font-weight: 600;
        }

        /* --- КАРТОЧКА --- */
        .card {
            background-color: var(--card-bg);
            border-radius: 32px; /* Сильное скругление как на фото */
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* ЗАГОЛОВОК */
        h1 {
            text-align: center;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 20px;
            font-size: 1.4rem;
            letter-spacing: 0.5px;
            color: #fff;
        }
        
        h1 span {
            color: var(--orange-accent);
        }

        /* ИНФО О РЕЙСЕ (Подзаголовок) */
        .trip-info-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 25px;
        }

        .trip-text-wrapper {
            text-align: center;
        }

        .trip-subtitle {
            color: var(--text-white);
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .trip-date-display {
            font-size: 10px;
            color: var(--text-gray);
            font-weight: 600;
            margin-top: 4px;
        }

        .edit-name-btn {
            background: transparent;
            border: none;
            color: var(--text-gray);
            font-size: 14px;
            padding: 4px;
            cursor: pointer;
        }

        /* ТАБЫ (Как переключатель Одометр/Пробег) */
        .tabs {
            display: flex;
            background-color: #252528; /* Темный фон подложки */
            border-radius: 16px;
            padding: 4px;
            margin-bottom: 25px;
        }

        .tab-btn {
            flex: 1;
            padding: 14px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-weight: 700;
            font-size: 11px;
            cursor: pointer;
            text-transform: uppercase;
            border-radius: 12px;
            transition: 0.2s;
            letter-spacing: 0.5px;
        }

        .tab-btn.active {
            background-color: #3a3a3c; /* Светлее фона */
            color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* ПОЛЯ ВВОДА */
        .input-row {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
        }
        .input-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 9px;
            font-weight: 700;
            color: var(--text-gray);
            text-transform: uppercase;
            margin-bottom: 8px;
            margin-left: 4px;
            letter-spacing: 0.5px;
        }

        input {
            width: 100%;
            background-color: var(--input-bg);
            border: none;
            border-radius: 14px;
            padding: 16px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            outline: none;
        }
        
        input::placeholder {
            color: #555;
        }

        input:focus {
            background-color: #3a3a3c;
        }

        /* КНОПКА ОТПРАВКИ */
        .submit-btn {
            width: 100%;
            padding: 18px;
            margin-top: 25px;
            border: none;
            border-radius: 16px;
            background-color: var(--orange-accent);
            color: white;
            font-weight: 800;
            font-size: 16px;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 109, 0, 0.25);
            transition: transform 0.1s;
        }
        .submit-btn:active {
            transform: scale(0.98);
            background-color: #e66200;
        }

        .balance-display {
            text-align: center;
            margin-top: 15px;
            font-size: 11px;
            color: var(--text-gray);
            font-weight: 600;
        }
        .balance-val { color: var(--text-white); margin-left: 5px; }

        /* ИСТОРИЯ (Нижняя панель) */
        .history-card {
            background-color: var(--card-bg);
            border-radius: 32px 32px 0 0; /* Скругление только сверху как шторка, или полное */
            border-radius: 32px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .history-title {
            font-weight: 900;
            text-transform: uppercase;
            font-size: 14px;
            color: #fff;
            letter-spacing: 0.5px;
        }

        .btn-reset {
            background: rgba(255, 69, 58, 0.15);
            color: var(--danger);
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            cursor: pointer;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .history-item:last-child { border-bottom: none; }

        .h-info { display: flex; flex-direction: column; }
        .h-cat { font-size: 13px; font-weight: 600; color: #fff; }
        .h-type { font-size: 10px; color: #666; margin-top: 2px; text-transform: uppercase;}
        
        .h-amount { font-size: 14px; font-weight: 700; }
        .inc { color: #32d74b; } /* iOS Green */
        .exp { color: var(--text-white); } /* White for expense in dark mode usually looks cleaner, or light gray */

        .empty-msg { text-align: center; color: #555; font-size: 12px; padding: 20px; }

    </style>
</head>
<body>

    <!-- Шапка картинка -->
    <div class="header-image-container">
        <!-- Используем то же изображение что и в коде, или похожее на скрин -->
        <img src="foto3.jpg" alt="Header">
    </div>

    <div class="main-wrapper">
        
        <!-- Навигация (Чипсы) -->
        <div class="trips-container">
            <button class="add-trip-btn" onclick="createNewTrip()">+</button>
            <div class="trips-scroll" id="trips-list">
                <!-- JS вставит сюда -->
            </div>
        </div>

        <!-- Основная карточка (Стиль как у "Расход Топлива") -->
        <div class="card">
            <h1>Учет <span>Финансов</span></h1>
            
            <!-- Инфо рейса -->
            <div class="trip-info-row">
                <div class="trip-text-wrapper">
                    <div class="trip-subtitle" id="current-trip-name">Маршрут</div>
                    <div class="trip-date-display" id="current-trip-date">01.01.2024</div>
                </div>
                <button class="edit-name-btn" onclick="editCurrentTripInfo()">✏️</button>
            </div>

            <!-- Вкладки (Стиль переключателя) -->
            <div class="tabs">
                <button class="tab-btn active" onclick="setMode('expense')">Расход</button>
                <button class="tab-btn" onclick="setMode('income')">Доход</button>
            </div>

            <!-- Поля ввода -->
            <div class="input-row">
                <div class="input-group">
                    <label>Сумма</label>
                    <input type="number" id="amount" placeholder="0">
                </div>
                <div class="input-group">
                    <label>Категория</label>
                    <input type="text" id="category" placeholder="ДТ, Еда...">
                </div>
            </div>

            <button class="submit-btn" onclick="addEntry()">Добавить</button>
            
            <div class="balance-display">
                Баланс рейса: <span id="total-balance" class="balance-val">0 ₽</span>
            </div>
        </div>

        <!-- История (Нижний блок) -->
        <div class="history-card">
            <div class="history-header">
                <div class="history-title">История</div>
                <button class="btn-reset" onclick="deleteCurrentTrip()">Удалить рейс</button>
            </div>

            <div class="history-list" id="history-list">
                <div class="empty-msg">Нет данных</div>
            </div>
        </div>

    </div>

    <script>
        // ЛОГИКА ОСТАЛАСЬ БЕЗ ИЗМЕНЕНИЙ
        let appData = JSON.parse(localStorage.getItem('financeAppData')) || {
            activeTripId: null,
            trips: []
        };

        let currentMode = 'expense';

        init();

        function init() {
            if (appData.trips.length === 0) {
                let startPoint = prompt("Введите пункт ОТПРАВЛЕНИЯ:");
                if (!startPoint) startPoint = "Начало";

                let endPoint = prompt("Введите пункт НАЗНАЧЕНИЯ:");
                if (!endPoint) endPoint = "Конец";
                
                let defaultDate = new Date().toLocaleDateString('ru-RU');
                
                const defaultTrip = {
                    id: Date.now(),
                    startPoint: startPoint.trim(),
                    endPoint: endPoint.trim(),
                    date: defaultDate,
                    transactions: []
                };
                
                appData.trips.push(defaultTrip);
                appData.activeTripId = defaultTrip.id;
                saveData();
            }
            
            if (!appData.trips.find(t => t.id === appData.activeTripId)) {
                if(appData.trips.length > 0) {
                    appData.activeTripId = appData.trips[0].id;
                }
            }

            renderTripsNav();
            renderCurrentTripUI();
        }

        function getTripDisplayName(trip) {
            if (trip.startPoint || trip.endPoint) {
                const s = trip.startPoint || "A";
                const e = trip.endPoint || "B";
                return `${s} - ${e}`;
            }
            return trip.name || "Рейс";
        }

        function createNewTrip() {
            const startPoint = prompt("Пункт ОТПРАВЛЕНИЯ:");
            if (startPoint === null) return; 

            const endPoint = prompt("Пункт НАЗНАЧЕНИЯ:");
            if (endPoint === null) return;

            let defaultDate = new Date().toLocaleDateString('ru-RU');
            const date = prompt("Дата рейса:", defaultDate);

            if (startPoint || endPoint) {
                const newTrip = {
                    id: Date.now(),
                    startPoint: startPoint ? startPoint.trim() : "А",
                    endPoint: endPoint ? endPoint.trim() : "Б",
                    date: (date && date.trim() !== "") ? date.trim() : defaultDate,
                    transactions: []
                };
                appData.trips.unshift(newTrip);
                appData.activeTripId = newTrip.id; 
                saveData();
                renderTripsNav();
                renderCurrentTripUI();
            }
        }

        function editCurrentTripInfo() {
            const trip = appData.trips.find(t => t.id === appData.activeTripId);
            if (!trip) return;

            const oldStart = trip.startPoint || "";
            const oldEnd = trip.endPoint || "";

            const newStart = prompt("Изменить пункт ОТПРАВЛЕНИЯ:", oldStart);
            if (newStart !== null) {
                trip.startPoint = newStart.trim();
                const newEnd = prompt("Изменить пункт НАЗНАЧЕНИЯ:", oldEnd);
                if (newEnd !== null) {
                    trip.endPoint = newEnd.trim();
                }
                const newDate = prompt("Изменить дату:", trip.date || "");
                if (newDate) trip.date = newDate.trim();

                saveData();
                renderTripsNav(); 
                renderCurrentTripUI(); 
            }
        }

        function switchTrip(id) {
            appData.activeTripId = id;
            saveData();
            renderTripsNav();
            renderCurrentTripUI();
        }

        function deleteCurrentTrip() {
            if (confirm("Удалить текущий рейс и всю его историю?")) {
                appData.trips = appData.trips.filter(t => t.id !== appData.activeTripId);
                appData.activeTripId = null; 
                saveData();
                location.reload(); // Перезагрузка для инициализации
            }
        }

        function renderTripsNav() {
            const container = document.getElementById('trips-list');
            container.innerHTML = '';
            appData.trips.forEach(trip => {
                const btn = document.createElement('div');
                btn.className = `trip-chip ${trip.id === appData.activeTripId ? 'active' : ''}`;
                const displayName = getTripDisplayName(trip);
                const displayDate = trip.date ? trip.date : '';
                btn.innerHTML = `
                    <div class="trip-chip-name">${displayName}</div>
                    <div class="trip-chip-date">${displayDate}</div>
                `;
                btn.onclick = () => switchTrip(trip.id);
                container.appendChild(btn);
            });
        }

        function renderCurrentTripUI() {
            const trip = appData.trips.find(t => t.id === appData.activeTripId);
            if (!trip) return;
            document.getElementById('current-trip-name').innerText = getTripDisplayName(trip);
            document.getElementById('current-trip-date').innerText = trip.date || "";
            renderHistory(trip);
        }

        function setMode(mode) {
            currentMode = mode;
            const buttons = document.querySelectorAll('.tab-btn');
            if (mode === 'expense') {
                buttons[0].classList.add('active');
                buttons[1].classList.remove('active');
            } else {
                buttons[1].classList.add('active');
                buttons[0].classList.remove('active');
            }
        }

        function addEntry() {
            const amountInput = document.getElementById('amount');
            const categoryInput = document.getElementById('category');
            const amount = parseFloat(amountInput.value);
            const category = categoryInput.value.trim() || (currentMode === 'expense' ? 'Расход' : 'Доход');

            if (!amount || amount <= 0) {
                alert('Введите корректную сумму');
                return;
            }

            const trip = appData.trips.find(t => t.id === appData.activeTripId);
            const transaction = {
                id: Date.now(),
                type: currentMode,
                amount: amount,
                category: category
            };

            trip.transactions.unshift(transaction);
            saveData();
            renderCurrentTripUI();
            amountInput.value = '';
            categoryInput.value = '';
        }

        function renderHistory(trip) {
            const list = document.getElementById('history-list');
            const balanceEl = document.getElementById('total-balance');
            list.innerHTML = '';
            let balance = 0;

            if (trip.transactions.length === 0) {
                list.innerHTML = '<div class="empty-msg">В этом рейсе записей нет</div>';
            } else {
                trip.transactions.forEach(t => {
                    if (t.type === 'income') balance += t.amount;
                    else balance -= t.amount;

                    const item = document.createElement('div');
                    item.className = 'history-item';
                    const colorClass = t.type === 'income' ? 'inc' : 'exp';
                    const sign = t.type === 'income' ? '+' : '-';
                    const typeLabel = t.type === 'income' ? 'Доход' : 'Расход';

                    item.innerHTML = `
                        <div class="h-info">
                            <span class="h-cat">${t.category}</span>
                            <span class="h-type">${typeLabel}</span>
                        </div>
                        <div class="h-amount ${colorClass}">${sign}${t.amount} ₽</div>
                    `;
                    list.appendChild(item);
                });
            }
            balanceEl.innerText = `${balance} ₽`;
            balanceEl.style.color = balance >= 0 ? '#fff' : '#ff453a';
        }

        function saveData() {
            localStorage.setItem('financeAppData', JSON.stringify(appData));
        }
    </script>
</body>
</html>
